(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[5660],{1649:(e,s,t)=>{"use strict";t.d(s,{C:()=>p});var a=t(5155),l=t(2115),r=t(3998),i=t(1834),n=t(1647),c=t(6948),d=t(5894),o=t(2033),x=t(8527),m=t(8428),h=t(8770),u=t(1389),j=t(5110);function p(){let{user:e}=(0,j.A)(),{toast:s}=(0,d.dj)(),[t,p]=(0,l.useState)(!1),[g,y]=(0,l.useState)(!1),[f,N]=(0,l.useState)(!1),[v,b]=(0,l.useState)(null),[w,C]=(0,l.useState)(!0);(0,l.useEffect)(()=>{A()},[null==e?void 0:e.id]);let A=async()=>{try{C(!0);let e=await fetch("/api/alice/oauth-status",{headers:{"Content-Type":"application/json"}}),s=await e.json();s.ok&&b(s.connection)}catch(e){console.error("Failed to check connection status:",e)}finally{C(!1)}},S=async()=>{try{if(y(!0),!(null==e?void 0:e.id))throw Error("User ID not found");let s=(null==e?void 0:e.role)==="master",t=await fetch("/api/alice/oauth/start?accountId=".concat(encodeURIComponent(e.id),"&isMaster=").concat(s));if(!t.ok){let e=await t.json();throw Error(e.message||"Failed to initiate OAuth")}let a=await t.json();if(a.ok&&a.redirectUrl)window.location.href=a.redirectUrl;else throw Error(a.message||"Invalid OAuth response")}catch(e){s({title:"Error",description:(null==e?void 0:e.message)||"Failed to connect to AliceBlue",variant:"destructive"}),y(!1)}},T=async()=>{if(null==v?void 0:v.accountId)try{N(!0);let e=await fetch("/api/alice/oauth-disconnect",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({accountId:v.accountId})}),t=await e.json();if(t.ok)s({title:"Disconnected",description:"AliceBlue connection removed"}),b(null),p(!1),await A();else throw Error(t.message||"Failed to disconnect")}catch(e){s({title:"Error",description:(null==e?void 0:e.message)||"Failed to disconnect",variant:"destructive"})}finally{N(!1)}};return(0,a.jsxs)(i.lG,{open:t,onOpenChange:p,children:[(0,a.jsx)(i.zM,{asChild:!0,children:(0,a.jsxs)(r.$,{variant:"outline",className:"gap-2",children:[(0,a.jsx)(PlugConnected,{className:"w-4 h-4"}),"AliceBlue Connection"]})}),(0,a.jsxs)(i.Cf,{className:"max-w-md",children:[(0,a.jsxs)(i.c7,{children:[(0,a.jsx)(i.L3,{children:"AliceBlue OAuth Connection"}),(0,a.jsx)(i.rr,{children:"Connect your AliceBlue account to start trading"})]}),(0,a.jsx)("div",{className:"space-y-4",children:w?(0,a.jsx)("div",{className:"flex items-center justify-center py-8",children:(0,a.jsx)(o.A,{className:"w-5 h-5 animate-spin"})}):(null==v?void 0:v.status)==="connected"?(0,a.jsx)(a.Fragment,{children:(0,a.jsxs)(c.Zp,{className:"border-green-200 bg-green-50",children:[(0,a.jsx)(c.aR,{className:"pb-3",children:(0,a.jsxs)("div",{className:"flex items-center gap-2",children:[(0,a.jsx)(x.A,{className:"w-5 h-5 text-green-600"}),(0,a.jsx)(c.ZB,{className:"text-base",children:"Connected"})]})}),(0,a.jsxs)(c.Wu,{className:"space-y-3",children:[(0,a.jsxs)("div",{children:[(0,a.jsx)("p",{className:"text-sm font-medium text-gray-600",children:"Account ID"}),(0,a.jsx)("p",{className:"text-sm font-mono text-gray-900",children:v.accountId})]}),v.connectedAt&&(0,a.jsxs)("div",{children:[(0,a.jsx)("p",{className:"text-sm font-medium text-gray-600",children:"Connected"}),(0,a.jsx)("p",{className:"text-sm text-gray-700",children:new Date(v.connectedAt).toLocaleString()})]}),v.expiresAt&&(0,a.jsxs)("div",{children:[(0,a.jsx)("p",{className:"text-sm font-medium text-gray-600",children:"Expires"}),(0,a.jsx)("p",{className:"text-sm text-gray-700",children:new Date(v.expiresAt).toLocaleString()})]}),(0,a.jsxs)("div",{className:"pt-2 border-t",children:[(0,a.jsx)("p",{className:"text-xs text-gray-600 mb-3",children:"✅ Your AliceBlue account is connected. Trades will sync automatically."}),(0,a.jsxs)(r.$,{variant:"destructive",size:"sm",className:"w-full gap-2",onClick:T,disabled:f,children:[f?(0,a.jsx)(o.A,{className:"w-4 h-4 animate-spin"}):(0,a.jsx)(m.A,{className:"w-4 h-4"}),"Disconnect"]})]})]})]})}):(0,a.jsxs)(a.Fragment,{children:[(0,a.jsxs)(c.Zp,{className:"border-yellow-200 bg-yellow-50",children:[(0,a.jsx)(c.aR,{className:"pb-3",children:(0,a.jsxs)("div",{className:"flex items-center gap-2",children:[(0,a.jsx)(h.A,{className:"w-5 h-5 text-yellow-600"}),(0,a.jsx)(c.ZB,{className:"text-base",children:"Not Connected"})]})}),(0,a.jsx)(c.Wu,{children:(0,a.jsx)("p",{className:"text-sm text-gray-700 mb-4",children:"Connect your AliceBlue account to enable trade syncing and copy-trading features."})})]}),(0,a.jsxs)("div",{className:"space-y-2",children:[(0,a.jsx)("p",{className:"text-xs font-medium text-gray-600",children:"Account Type"}),(0,a.jsx)(n.E,{variant:"outline",className:"w-full justify-center py-2",children:(null==e?void 0:e.role)==="master"?"\uD83C\uDFAF Master Account":"\uD83D\uDCCA Follower Account"})]}),(0,a.jsx)(r.$,{onClick:S,disabled:g,className:"w-full gap-2",size:"lg",children:g?(0,a.jsxs)(a.Fragment,{children:[(0,a.jsx)(o.A,{className:"w-4 h-4 animate-spin"}),"Connecting..."]}):(0,a.jsxs)(a.Fragment,{children:[(0,a.jsx)(u.A,{className:"w-4 h-4"}),"Connect to AliceBlue"]})}),(0,a.jsx)("p",{className:"text-xs text-gray-500 text-center",children:"You'll be redirected to AliceBlue to securely authenticate."})]})})]})]})}},8048:(e,s,t)=>{"use strict";t.r(s),t.d(s,{default:()=>J});var a=t(5155),l=t(5110),r=t(2115),i=t(6948),n=t(2271),c=t(7083),d=t(2619),o=t.n(d),x=t(3998),m=t(1647),h=t(1834),u=t(8332),j=t(5894),p=t(2033),g=t(8770),y=t(6713),f=t(8527),N=t(8428);function v(){let{toast:e}=(0,j.dj)(),[s,t]=(0,r.useState)(null),[l,n]=(0,r.useState)(!0),[c,d]=(0,r.useState)(!1),[o,h]=(0,r.useState)(!1);(0,r.useEffect)(()=>{v()},[]);let v=async()=>{try{let e=await fetch("/api/master/status"),s=await e.json();s.ok&&t(s.master)}catch(e){console.error("Failed to check master status:",e)}finally{n(!1)}},b=async()=>{h(!0);try{let s=await fetch("/api/master/disconnect",{method:"POST"});(await s.json()).ok&&(t(null),e({title:"Disconnected",description:"Master account disconnected from Alice Blue"}))}catch(s){e({title:"Error",description:s.message,variant:"destructive"})}finally{h(!1)}};return l?(0,a.jsx)(i.Zp,{children:(0,a.jsx)(i.Wu,{className:"pt-6 flex justify-center",children:(0,a.jsx)(p.A,{className:"h-6 w-6 animate-spin text-muted-foreground"})})}):s?(0,a.jsxs)(i.Zp,{className:"border-green-200 bg-green-50",children:[(0,a.jsxs)(i.aR,{children:[(0,a.jsxs)(i.ZB,{className:"flex items-center gap-2",children:[(0,a.jsx)(f.A,{className:"h-5 w-5 text-green-600"}),"Master Account Connected"]}),(0,a.jsx)(i.BT,{children:"Your Alice Blue account is ready for copy trading"})]}),(0,a.jsxs)(i.Wu,{className:"space-y-4",children:[(0,a.jsxs)("div",{className:"space-y-2",children:[(0,a.jsxs)("div",{className:"flex justify-between items-center",children:[(0,a.jsx)("span",{className:"text-sm font-medium",children:"Account ID:"}),(0,a.jsx)("span",{className:"text-sm font-mono bg-white px-3 py-1 rounded",children:s.userId})]}),(0,a.jsxs)("div",{className:"flex justify-between items-center",children:[(0,a.jsx)("span",{className:"text-sm font-medium",children:"Token:"}),(0,a.jsx)("span",{className:"text-sm font-mono bg-white px-3 py-1 rounded",children:s.tokenMask})]}),(0,a.jsxs)("div",{className:"flex justify-between items-center",children:[(0,a.jsx)("span",{className:"text-sm font-medium",children:"Status:"}),(0,a.jsx)(m.E,{className:"bg-green-600 hover:bg-green-700",children:"Active"})]})]}),(0,a.jsx)(u.Fc,{className:"bg-white border-green-200",children:(0,a.jsx)(u.TN,{className:"text-sm",children:'✅ Ready! Your trades will appear on the dashboard. Select followers and click "Copy" to replicate trades.'})}),(0,a.jsx)(x.$,{onClick:b,disabled:o,variant:"outline",className:"w-full text-red-600 border-red-200 hover:bg-red-50",children:o?(0,a.jsxs)(a.Fragment,{children:[(0,a.jsx)(p.A,{className:"h-4 w-4 mr-2 animate-spin"}),"Disconnecting..."]}):(0,a.jsxs)(a.Fragment,{children:[(0,a.jsx)(N.A,{className:"h-4 w-4 mr-2"}),"Disconnect"]})})]})]}):(0,a.jsxs)(i.Zp,{className:"border-yellow-200 bg-yellow-50",children:[(0,a.jsxs)(i.aR,{children:[(0,a.jsxs)(i.ZB,{className:"flex items-center gap-2",children:[(0,a.jsx)(g.A,{className:"h-5 w-5 text-yellow-600"}),"Master Account Not Connected"]}),(0,a.jsx)(i.BT,{children:"Connect your Alice Blue account to start copy trading"})]}),(0,a.jsxs)(i.Wu,{children:[(0,a.jsx)(x.$,{onClick:()=>{d(!0);let e=new URL("/api/alice/oauth/vendor/start",window.location.origin);window.location.href=e.toString()},disabled:c,size:"lg",className:"w-full",children:c?(0,a.jsxs)(a.Fragment,{children:[(0,a.jsx)(p.A,{className:"h-4 w-4 mr-2 animate-spin"}),"Connecting..."]}):(0,a.jsxs)(a.Fragment,{children:[(0,a.jsx)(y.A,{className:"h-4 w-4 mr-2"}),"Connect to Alice Blue"]})}),(0,a.jsx)("p",{className:"text-xs text-muted-foreground mt-4",children:"You will be redirected to Alice Blue to authorize this app. After login, your token will be automatically stored."})]})]})}var b=t(3062),w=t(8941),C=t(2111),A=t(8053);function S(e){let{follower:s,onSelect:t}=e,{toast:l}=(0,j.dj)(),[n,c]=(0,r.useState)(!0),[d,o]=(0,r.useState)(!1);(0,r.useEffect)(()=>{(async()=>{try{let e=await fetch("/api/followers/stop-copy-trading?followerId=".concat(encodeURIComponent(s.id))),t=await e.json();t.ok&&c(t.copyTradingActive)}catch(e){console.error("Failed to check copy trading status:",e)}})()},[s.id]);let h=async(e,t)=>{t.stopPropagation(),o(!0);try{let t=await fetch("/api/followers/stop-copy-trading",{method:"PATCH",headers:{"Content-Type":"application/json"},body:JSON.stringify({followerId:s.id,action:e})}),a=await t.json();if(!t.ok)throw Error(a.message||"Failed to ".concat(e," copy trading"));c(a.consent.copyTradingActive),l({title:"stop"===e?"Copy Trading Stopped":"Copy Trading Resumed",description:"".concat(s.name," will ").concat("stop"===e?"no longer":"now"," receive copy trades")})}catch(s){l({title:"Error",description:s.message||"Failed to ".concat(e," copy trading"),variant:"destructive"})}finally{o(!1)}};return(0,a.jsx)(i.Zp,{className:"cursor-pointer hover:shadow-lg hover:border-primary transition-all flex flex-col h-full",onClick:()=>t(s),children:(0,a.jsxs)(i.Wu,{className:"pt-6 flex-1 flex flex-col",children:[(0,a.jsxs)("div",{className:"space-y-3 flex-1",children:[(0,a.jsxs)("div",{className:"flex items-start justify-between gap-2",children:[(0,a.jsxs)("div",{children:[(0,a.jsx)("h3",{className:"font-semibold text-sm",children:s.name}),(0,a.jsx)("p",{className:"text-xs text-muted-foreground",children:s.id})]}),(0,a.jsx)(m.E,{variant:n?"default":"destructive",className:"whitespace-nowrap text-xs font-semibold",children:n?"\uD83D\uDFE2 REPLICATING":"\uD83D\uDD34 STOPPED"})]}),(0,a.jsxs)("div",{className:"border-t pt-2 space-y-1 text-xs",children:[(0,a.jsxs)("div",{className:"flex justify-between",children:[(0,a.jsx)("span",{className:"text-muted-foreground",children:"Client ID:"}),(0,a.jsx)("span",{className:"font-mono truncate",children:s.clientId?s.clientId.slice(0,8)+"...":"-"})]}),(0,a.jsxs)("div",{className:"flex justify-between",children:[(0,a.jsx)("span",{className:"text-muted-foreground",children:"Status:"}),(0,a.jsx)("span",{className:s.consentGiven?"text-green-600 font-medium":"text-yellow-600 font-medium",children:s.consentGiven?"✓ Active":"⚠ Pending"})]})]})]}),(0,a.jsxs)("div",{className:"border-t pt-3 mt-3 space-y-2",children:[n?(0,a.jsxs)(A.Lt,{children:[(0,a.jsx)(A.tv,{asChild:!0,children:(0,a.jsxs)(x.$,{variant:"destructive",size:"sm",className:"w-full font-semibold",disabled:d,onClick:e=>e.stopPropagation(),children:[d&&(0,a.jsx)(p.A,{className:"w-4 h-4 mr-1 animate-spin"}),(0,a.jsx)(w.A,{className:"w-4 h-4 mr-1"}),"Stop Copy Trading"]})}),(0,a.jsxs)(A.EO,{onClick:e=>e.stopPropagation(),children:[(0,a.jsxs)(A.wd,{children:[(0,a.jsx)(A.r7,{className:"text-lg",children:"Stop Copy Trading?"}),(0,a.jsxs)(A.$v,{className:"text-base",children:[(0,a.jsx)("strong",{children:s.name})," will no longer receive copy trades from your master account. Any open positions will remain. You can resume anytime."]})]}),(0,a.jsxs)("div",{className:"flex gap-3",children:[(0,a.jsx)(A.Zr,{children:"Cancel"}),(0,a.jsx)(A.Rx,{onClick:e=>h("stop",e),className:"bg-destructive hover:bg-destructive/90",children:"Yes, Stop Copy Trading"})]})]})]}):(0,a.jsxs)(x.$,{variant:"default",size:"sm",className:"w-full bg-green-600 hover:bg-green-700 font-semibold",disabled:d,onClick:e=>h("resume",e),children:[d&&(0,a.jsx)(p.A,{className:"w-4 h-4 mr-1 animate-spin"}),(0,a.jsx)(C.A,{className:"w-4 h-4 mr-1"}),"Start Copy Trading"]}),(0,a.jsx)(x.$,{variant:"outline",size:"sm",className:"w-full text-xs text-muted-foreground",onClick:e=>e.stopPropagation(),children:"View Details"})]})]})})}var T=t(1649),k=t(5142),F=t(6444),I=t(1186),B=t(1480);function E(){let[e,s]=(0,r.useState)(!1),[t,l]=(0,r.useState)(!1),{toast:n}=(0,j.dj)(),[c,d]=(0,r.useState)({symbol:"",side:"BUY",masterQty:"",price:""}),o=async()=>{if(!c.symbol||!c.masterQty||!c.price)return void n({variant:"destructive",title:"Missing Fields",description:"Please fill all required fields"});l(!0);try{let e=await fetch("/api/followers/list"),t=await e.json();if(!t.ok||0===t.followers.length){n({variant:"destructive",title:"No Followers",description:"No followers registered yet. Add a follower first."}),l(!1);return}let a=0;for(let e of t.followers)(await fetch("/api/followers/copy-trades-log",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({masterId:"master_account",followerId:e.id,symbol:c.symbol.toUpperCase(),side:c.side.toUpperCase(),masterQty:parseInt(c.masterQty),followerQty:Math.floor(parseInt(c.masterQty)*(e.lotMultiplier||1)),price:parseFloat(c.price),status:"SUCCESS"})})).ok&&a++;n({title:"Copy Trades Created",description:"".concat(a," copy trade(s) logged for all followers")}),d({symbol:"",side:"BUY",masterQty:"",price:""}),s(!1)}catch(e){console.error("Error creating copy trades:",e),n({variant:"destructive",title:"Error",description:"Failed to create copy trades"})}finally{l(!1)}};return(0,a.jsx)("div",{className:"space-y-4",children:(0,a.jsxs)(i.Zp,{className:"bg-amber-50 border-amber-200",children:[(0,a.jsxs)(i.aR,{children:[(0,a.jsxs)(i.ZB,{className:"flex items-center gap-2 text-base",children:[(0,a.jsx)(B.A,{className:"w-4 h-4"}),"Manual Copy Trade (Testing)"]}),(0,a.jsx)(i.BT,{children:"Manually trigger copy trades to all followers for testing purposes"})]}),(0,a.jsx)(i.Wu,{children:(0,a.jsxs)(h.lG,{open:e,onOpenChange:s,children:[(0,a.jsx)(h.zM,{asChild:!0,children:(0,a.jsx)(x.$,{variant:"outline",className:"w-full",children:"Test Copy Trade"})}),(0,a.jsxs)(h.Cf,{className:"sm:max-w-md",children:[(0,a.jsxs)(h.c7,{children:[(0,a.jsx)(h.L3,{children:"Create Test Copy Trade"}),(0,a.jsx)(h.rr,{children:"This will create a copy trade entry for all registered followers"})]}),(0,a.jsxs)("div",{className:"space-y-4 py-4",children:[(0,a.jsxs)("div",{className:"space-y-2",children:[(0,a.jsx)(F.J,{htmlFor:"symbol",children:"Symbol *"}),(0,a.jsx)(k.p,{id:"symbol",placeholder:"e.g., RELIANCE",value:c.symbol,onChange:e=>d(s=>({...s,symbol:e.target.value.toUpperCase()}))})]}),(0,a.jsxs)("div",{className:"space-y-2",children:[(0,a.jsx)(F.J,{htmlFor:"side",children:"Side *"}),(0,a.jsxs)(I.l6,{value:c.side,onValueChange:e=>d(s=>({...s,side:e})),children:[(0,a.jsx)(I.bq,{id:"side",children:(0,a.jsx)(I.yv,{})}),(0,a.jsxs)(I.gC,{children:[(0,a.jsx)(I.eb,{value:"BUY",children:"Buy"}),(0,a.jsx)(I.eb,{value:"SELL",children:"Sell"})]})]})]}),(0,a.jsxs)("div",{className:"space-y-2",children:[(0,a.jsx)(F.J,{htmlFor:"masterQty",children:"Master Quantity *"}),(0,a.jsx)(k.p,{id:"masterQty",type:"number",placeholder:"e.g., 100",value:c.masterQty,onChange:e=>d(s=>({...s,masterQty:e.target.value}))})]}),(0,a.jsxs)("div",{className:"space-y-2",children:[(0,a.jsx)(F.J,{htmlFor:"price",children:"Price (₹) *"}),(0,a.jsx)(k.p,{id:"price",type:"number",placeholder:"e.g., 2850.50",step:"0.05",value:c.price,onChange:e=>d(s=>({...s,price:e.target.value}))})]}),(0,a.jsxs)("div",{className:"bg-blue-50 border border-blue-200 rounded p-3 flex gap-2",children:[(0,a.jsx)(g.A,{className:"w-4 h-4 text-blue-600 flex-shrink-0 mt-0.5"}),(0,a.jsx)("p",{className:"text-sm text-blue-900",children:"Follower quantities will be calculated based on their lot multiplier"})]})]}),(0,a.jsxs)(h.Es,{children:[(0,a.jsx)(h.HM,{asChild:!0,children:(0,a.jsx)(x.$,{variant:"ghost",children:"Cancel"})}),(0,a.jsx)(x.$,{onClick:o,disabled:t,children:t?"Creating...":"Create Copy Trade"})]})]})]})})]})})}var M=t(6615);function P(){let{followerAccounts:e}=(0,c.F)(),[s,t]=(0,r.useState)(null);return(0,a.jsxs)("div",{className:"flex flex-col gap-8",children:[(0,a.jsxs)("div",{className:"flex items-center justify-between",children:[(0,a.jsxs)("div",{children:[(0,a.jsx)("h1",{className:"text-3xl font-bold",children:"Dashboard"}),(0,a.jsx)("p",{className:"text-muted-foreground mt-1",children:"Manage your master trading account"})]}),(0,a.jsx)(o(),{href:"/connections",className:"flex gap-2",children:(0,a.jsx)(T.C,{})})]}),(0,a.jsx)(v,{}),(0,a.jsxs)(i.Zp,{className:"border-2 border-primary/20",children:[(0,a.jsxs)(i.aR,{children:[(0,a.jsx)(i.ZB,{className:"text-2xl",children:"Master Trade Book"}),(0,a.jsx)(i.BT,{children:"Real-time trades from your master Alice Blue account"})]}),(0,a.jsx)(i.Wu,{children:(0,a.jsx)(n.q,{})})]}),(0,a.jsx)(E,{}),(0,a.jsxs)("div",{children:[(0,a.jsxs)("div",{className:"flex items-center justify-between mb-6",children:[(0,a.jsxs)("div",{children:[(0,a.jsx)("h2",{className:"text-2xl font-bold",children:"Followers"}),(0,a.jsx)("p",{className:"text-sm text-muted-foreground mt-1",children:"Click on a follower to view their trade book and manage settings"})]}),(0,a.jsxs)("div",{className:"flex gap-2",children:[(0,a.jsx)(b.U,{}),(0,a.jsx)(x.$,{asChild:!0,variant:"outline",children:(0,a.jsx)(o(),{href:"/configuration",children:"Manage All"})})]})]}),e&&e.length>0?(0,a.jsxs)(a.Fragment,{children:[(0,a.jsx)("div",{className:"grid gap-3 grid-cols-1 sm:grid-cols-2 md:grid-cols-3 lg:grid-cols-4 mb-6",children:e.map(e=>(0,a.jsx)(S,{follower:e,onSelect:t},e.id))}),s&&(0,a.jsxs)(i.Zp,{className:"border-2 border-blue-200 bg-blue-50/20",children:[(0,a.jsxs)(i.aR,{className:"flex flex-row items-start justify-between space-y-0 pb-4",children:[(0,a.jsxs)("div",{className:"flex-1",children:[(0,a.jsx)(i.ZB,{className:"text-xl",children:s.name}),(0,a.jsx)(i.BT,{children:s.id})]}),(0,a.jsx)(x.$,{variant:"ghost",size:"sm",onClick:()=>t(null),className:"h-8 w-8 p-0",children:(0,a.jsx)(M.A,{className:"h-4 w-4"})})]}),(0,a.jsxs)(i.Wu,{className:"space-y-6",children:[(0,a.jsxs)("div",{className:"grid grid-cols-2 md:grid-cols-4 gap-4 p-4 bg-white rounded border",children:[(0,a.jsxs)("div",{children:[(0,a.jsx)("p",{className:"text-xs text-muted-foreground",children:"Client ID"}),(0,a.jsx)("p",{className:"font-mono text-sm mt-1",children:s.clientId||"-"})]}),(0,a.jsxs)("div",{children:[(0,a.jsx)("p",{className:"text-xs text-muted-foreground",children:"Status"}),(0,a.jsx)("p",{className:"text-sm font-medium mt-1 ".concat(s.consentGiven?"text-green-600":"text-yellow-600"),children:s.consentGiven?"✓ Active":"⚠ Pending"})]}),(0,a.jsxs)("div",{children:[(0,a.jsx)("p",{className:"text-xs text-muted-foreground",children:"Lot Multiplier"}),(0,a.jsxs)("p",{className:"font-medium text-sm mt-1",children:[s.lotMultiplier||"1.0","x"]})]}),(0,a.jsxs)("div",{children:[(0,a.jsx)("p",{className:"text-xs text-muted-foreground",children:"Max Quantity"}),(0,a.jsx)("p",{className:"font-medium text-sm mt-1",children:s.perAccountCap||"-"})]})]}),(0,a.jsx)(i.Zp,{className:"border-l-4 border-l-blue-500 bg-blue-50",children:(0,a.jsx)(i.Wu,{className:"pt-4",children:(0,a.jsxs)("div",{className:"flex items-center justify-between",children:[(0,a.jsxs)("div",{children:[(0,a.jsx)("p",{className:"text-sm font-medium",children:"Copy Trading Status"}),(0,a.jsx)("p",{className:"text-xs text-muted-foreground mt-1",children:s.consentGiven?"This follower is ready to receive your trades":"Consent required before copy trading can start"})]}),(0,a.jsx)(m.E,{className:"ml-2 text-base px-3 py-2",children:s.consentGiven?"✓ Ready":"⚠ Pending"})]})})}),(0,a.jsxs)("div",{children:[(0,a.jsxs)("h3",{className:"text-lg font-semibold mb-3",children:[s.name," - Copied Trades"]}),(0,a.jsx)(n.q,{})]}),(0,a.jsxs)("div",{className:"flex gap-2 pt-4 border-t",children:[(0,a.jsx)(e=>{let{account:s}=e,[t,l]=(0,r.useState)(s.clientId||""),[i,n]=(0,r.useState)(s.apiKey||""),[c,d]=(0,r.useState)(s.consentGiven||!1),[o,m]=(0,r.useState)(s.brokerSessionId||""),[u,j]=(0,r.useState)(!1),p=async()=>{if(t&&i)try{let e=await fetch("/api/followers/credentials",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({followerId:s.id,clientId:t,apiKey:i,brokerSessionId:o||void 0,accessToken:"api_auth"})});(await e.json()).ok&&j(!1)}catch(e){console.error("Failed to save credentials",e)}};return(0,a.jsxs)(h.lG,{open:u,onOpenChange:j,children:[(0,a.jsx)(x.$,{onClick:()=>j(!0),variant:"outline",size:"sm",children:"Manage"}),(0,a.jsxs)(h.Cf,{className:"sm:max-w-sm",children:[(0,a.jsx)(h.c7,{children:(0,a.jsxs)(h.L3,{children:["Manage ",s.name]})}),(0,a.jsxs)("div",{className:"grid gap-3",children:[(0,a.jsxs)("div",{children:[(0,a.jsx)("label",{className:"text-sm font-medium",children:"Client ID"}),(0,a.jsx)("input",{type:"text",value:t,onChange:e=>l(e.target.value),className:"w-full border rounded px-2 py-1 text-sm mt-1"})]}),(0,a.jsxs)("div",{children:[(0,a.jsx)("label",{className:"text-sm font-medium",children:"API Key"}),(0,a.jsx)("input",{type:"password",value:i,onChange:e=>n(e.target.value),className:"w-full border rounded px-2 py-1 text-sm mt-1"})]}),(0,a.jsxs)("div",{children:[(0,a.jsx)("label",{className:"text-sm font-medium",children:"Broker Session ID (Optional)"}),(0,a.jsx)("input",{type:"text",value:o,onChange:e=>m(e.target.value),className:"w-full border rounded px-2 py-1 text-sm mt-1"})]}),(0,a.jsxs)("div",{className:"flex gap-2",children:[(0,a.jsx)(x.$,{onClick:p,className:"flex-1",children:"Save"}),(0,a.jsx)(x.$,{onClick:()=>j(!1),variant:"ghost",className:"flex-1",children:"Cancel"})]})]})]})]})},{account:s}),(0,a.jsx)(x.$,{asChild:!0,variant:"outline",className:"flex-1",children:(0,a.jsx)(o(),{href:"/configuration",children:"Settings"})})]})]})]})]}):(0,a.jsx)(i.Zp,{className:"p-12 text-center border-dashed",children:(0,a.jsxs)("div",{className:"text-muted-foreground",children:[(0,a.jsx)("p",{className:"mb-4 text-lg",children:"No followers added yet"}),(0,a.jsx)(b.U,{})]})})]})]})}var R=t(7270),O=t(4269),Z=t(1330);function $(e){let{followerId:s}=e,{followerTrades:t}=(0,c.F)(),l=t[s]||[];return(0,a.jsx)("div",{className:"w-full overflow-auto",children:(0,a.jsxs)(R.XI,{children:[(0,a.jsx)(R.A0,{children:(0,a.jsxs)(R.Hj,{children:[(0,a.jsx)(R.nd,{children:"Timestamp"}),(0,a.jsx)(R.nd,{children:"Symbol"}),(0,a.jsx)(R.nd,{children:"Side"}),(0,a.jsx)(R.nd,{className:"text-right",children:"Quantity"}),(0,a.jsx)(R.nd,{className:"text-right",children:"Price"}),(0,a.jsx)(R.nd,{className:"text-right",children:"Total Value"})]})}),(0,a.jsx)(R.BF,{children:0===l.length?(0,a.jsx)(R.Hj,{children:(0,a.jsx)(R.nA,{colSpan:6,className:"h-24 text-center",children:"You haven't placed any trades yet."})}):l.map(e=>(0,a.jsxs)(R.Hj,{children:[(0,a.jsx)(R.nA,{children:(0,Z.GP)(new Date(e.timestamp),"HH:mm:ss")}),(0,a.jsx)(R.nA,{className:"font-medium",children:e.symbol}),(0,a.jsx)(R.nA,{className:(0,O.cn)("Buy"===e.side?"text-green-600":"text-red-600"),children:e.side}),(0,a.jsx)(R.nA,{className:"text-right",children:e.quantity}),(0,a.jsxs)(R.nA,{className:"text-right",children:["₹",e.price.toFixed(2)]}),(0,a.jsxs)(R.nA,{className:"text-right",children:["₹",(e.quantity*e.price).toLocaleString(void 0,{minimumFractionDigits:2,maximumFractionDigits:2})]})]},e.id))})]})})}function D(){return(0,a.jsxs)(i.Zp,{children:[(0,a.jsxs)(i.aR,{children:[(0,a.jsx)(i.ZB,{children:"Live Copy Trading"}),(0,a.jsx)(i.BT,{children:"Real-time tracking of copy trades from your connected master traders"})]}),(0,a.jsx)(i.Wu,{children:(0,a.jsx)("div",{className:"space-y-4",children:(0,a.jsxs)("div",{className:"flex items-center justify-between p-4 border rounded-lg",children:[(0,a.jsxs)("div",{children:[(0,a.jsx)("p",{className:"font-semibold text-sm",children:"No Active Masters"}),(0,a.jsx)("p",{className:"text-sm text-muted-foreground",children:"Connect to a master trader to start receiving copy trades"})]}),(0,a.jsx)(m.E,{variant:"secondary",children:"Inactive"})]})})})]})}function U(){let{user:e}=(0,l.A)(),{addFollowerTrade:s}=(0,c.F)(),{toast:t}=(0,j.dj)(),[n,d]=(0,r.useState)(!1),[o,m]=(0,r.useState)({symbol:"",side:"Buy",quantity:"",price:""});return e?(0,a.jsxs)("div",{className:"space-y-6",children:[(0,a.jsx)(D,{}),(0,a.jsxs)("div",{className:"border-t pt-6",children:[(0,a.jsx)("h2",{className:"text-2xl font-bold mb-4",children:"Your Manual Trades"}),(0,a.jsx)("p",{className:"text-sm text-muted-foreground mb-4",children:"Log any manual trades you place on your account."}),(0,a.jsxs)(i.Zp,{children:[(0,a.jsxs)(i.aR,{children:[(0,a.jsx)(i.ZB,{children:"Trade Log"}),(0,a.jsx)(i.BT,{children:"A log of all trades you have manually placed."})]}),(0,a.jsxs)(i.Wu,{children:[(0,a.jsx)("div",{className:"flex justify-end mb-4",children:(0,a.jsxs)(h.lG,{open:n,onOpenChange:d,children:[(0,a.jsx)(h.zM,{asChild:!0,children:(0,a.jsx)(x.$,{children:"Add Trade"})}),(0,a.jsxs)(h.Cf,{className:"sm:max-w-md",children:[(0,a.jsxs)(h.c7,{children:[(0,a.jsx)(h.L3,{children:"Add Manual Trade"}),(0,a.jsx)(h.rr,{children:"Provide trade details to log a manual trade for your follower account."})]}),(0,a.jsxs)("div",{className:"grid gap-4 py-4",children:[(0,a.jsxs)("div",{className:"space-y-2",children:[(0,a.jsx)(F.J,{htmlFor:"symbol",children:"Symbol"}),(0,a.jsx)(k.p,{id:"symbol",value:o.symbol,onChange:e=>m(s=>({...s,symbol:e.target.value.toUpperCase()})),placeholder:"e.g., RELIANCE"})]}),(0,a.jsxs)("div",{className:"space-y-2",children:[(0,a.jsx)(F.J,{htmlFor:"side",children:"Side"}),(0,a.jsxs)(I.l6,{value:o.side,onValueChange:e=>m(s=>({...s,side:e})),children:[(0,a.jsx)(I.bq,{id:"side",children:(0,a.jsx)(I.yv,{placeholder:"Select side"})}),(0,a.jsxs)(I.gC,{children:[(0,a.jsx)(I.eb,{value:"Buy",children:"Buy"}),(0,a.jsx)(I.eb,{value:"Sell",children:"Sell"})]})]})]}),(0,a.jsxs)("div",{className:"space-y-2",children:[(0,a.jsx)(F.J,{htmlFor:"quantity",children:"Quantity"}),(0,a.jsx)(k.p,{id:"quantity",type:"number",value:o.quantity,onChange:e=>m(s=>({...s,quantity:e.target.value})),placeholder:"e.g., 100"})]}),(0,a.jsxs)("div",{className:"space-y-2",children:[(0,a.jsx)(F.J,{htmlFor:"price",children:"Price"}),(0,a.jsx)(k.p,{id:"price",type:"number",value:o.price,onChange:e=>m(s=>({...s,price:e.target.value})),placeholder:"e.g., 2850.50"})]})]}),(0,a.jsxs)(h.Es,{children:[(0,a.jsx)(h.HM,{asChild:!0,children:(0,a.jsx)(x.$,{variant:"ghost",children:"Cancel"})}),(0,a.jsx)(x.$,{onClick:()=>{if(!e||!o.symbol||!o.quantity||!o.price)return void t({variant:"destructive",title:"Missing Information",description:"Please fill out all trade details."});s(e.id,{...o,quantity:parseInt(o.quantity,10),price:parseFloat(o.price)}),t({title:"Trade Added",description:"Your trade for ".concat(o.symbol," has been logged.")}),m({symbol:"",side:"Buy",quantity:"",price:""}),d(!1)},children:"Add Trade"})]})]})]})}),(0,a.jsx)($,{followerId:e.id})]})]})]})]}):null}var q=t(243),L=t(63);function J(){let{user:e,loading:s}=(0,l.A)(),t=(0,L.useSearchParams)(),i=(0,L.useRouter)(),[n,c]=(0,r.useState)(!1);return((0,r.useEffect)(()=>{let e=t.get("authCode"),s=t.get("userId");e&&s&&!n&&(c(!0),fetch("/aliceblue/callback?authCode=".concat(encodeURIComponent(e),"&userId=").concat(encodeURIComponent(s)),{credentials:"same-origin"}).then(()=>{try{let e=document.cookie.split(";").reduce((e,s)=>{let[t,a]=s.trim().split("=");return t&&a&&(e[t]=decodeURIComponent(a)),e},{});if(e.alice_user){try{let s={...JSON.parse(e.alice_user),role:"trader",authMethod:"oauth"};localStorage.setItem("user",JSON.stringify(s))}catch(e){console.warn("Failed to parse alice_user cookie",e)}document.cookie="alice_user=; expires=Thu, 01 Jan 1970 00:00:00 UTC; path=/;"}}catch(e){console.warn("Failed to persist OAuth user from cookie",e)}i.replace("/dashboard")}).catch(e=>{console.error("OAuth callback processing failed:",e),c(!1)}))},[t,n,i]),s||!e||n)?(0,a.jsxs)("div",{className:"space-y-6",children:[(0,a.jsxs)("div",{className:"grid gap-4 md:grid-cols-3",children:[(0,a.jsx)(q.E,{className:"h-28"}),(0,a.jsx)(q.E,{className:"h-28"}),(0,a.jsx)(q.E,{className:"h-28"})]}),(0,a.jsx)(q.E,{className:"h-96"})]}):"master"===e.role||"trader"===e.role&&"oauth"===e.authMethod?(0,a.jsx)(P,{}):(0,a.jsx)(U,{})}},8347:(e,s,t)=>{Promise.resolve().then(t.bind(t,8048))}},e=>{e.O(0,[7349,7953,85,576,9222,9795,2917,6999,5110,3062,7013,8441,1255,7358],()=>e(e.s=8347)),_N_E=e.O()}]);