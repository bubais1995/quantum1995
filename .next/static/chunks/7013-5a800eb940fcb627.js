"use strict";(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[7013],{243:(e,t,s)=>{s.d(t,{E:()=>l});var r=s(5155),a=s(4269);function l(e){let{className:t,...s}=e;return(0,r.jsx)("div",{className:(0,a.cn)("animate-pulse rounded-md bg-muted",t),...s})}},1647:(e,t,s)=>{s.d(t,{E:()=>d});var r=s(5155);s(2115);var a=s(3101),l=s(4269);let n=(0,a.F)("inline-flex items-center rounded-full border px-2.5 py-0.5 text-xs font-semibold transition-colors focus:outline-none focus:ring-2 focus:ring-ring focus:ring-offset-2",{variants:{variant:{default:"border-transparent bg-primary text-primary-foreground hover:bg-primary/80",secondary:"border-transparent bg-secondary text-secondary-foreground hover:bg-secondary/80",destructive:"border-transparent bg-destructive text-destructive-foreground hover:bg-destructive/80",outline:"text-foreground"}},defaultVariants:{variant:"default"}});function d(e){let{className:t,variant:s,...a}=e;return(0,r.jsx)("div",{className:(0,l.cn)(n({variant:s}),t),...a})}},2271:(e,t,s)=>{s.d(t,{q:()=>N});var r=s(5155),a=s(2115),l=s(7270),n=s(3998),d=s(243),i=s(1288),c=s(1834),o=s(8162),m=s(2251),u=s(4269);let x=a.forwardRef((e,t)=>{let{className:s,...a}=e;return(0,r.jsx)(o.bL,{ref:t,className:(0,u.cn)("peer h-4 w-4 shrink-0 rounded-sm border border-primary ring-offset-background focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-ring focus-visible:ring-offset-2 disabled:cursor-not-allowed disabled:opacity-50 data-[state=checked]:bg-primary data-[state=checked]:text-primary-foreground",s),...a,children:(0,r.jsx)(o.C1,{className:(0,u.cn)("flex items-center justify-center text-current"),children:(0,r.jsx)(m.A,{className:"h-4 w-4"})})})});x.displayName=o.bL.displayName;var f=s(6444),h=s(7083),p=s(5894),j=s(8770),y=s(2033),g=s(8332);function b(e){let{open:t,onOpenChange:s,trade:l}=e,{followerAccounts:d}=(0,h.F)(),{toast:i}=(0,p.dj)(),[o,m]=(0,a.useState)(new Set),[u,b]=(0,a.useState)(!1),N=async()=>{if(!l||0===o.size)return void i({title:"Error",description:"Please select at least one follower",variant:"destructive"});b(!0);try{let e=await fetch("/api/trades/copy-selected",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({trade:{id:l.id,symbol:l.symbol,side:"Buy"===l.side?"BUY":"SELL",quantity:l.quantity,price:l.price,order_type:"Market"===l.type?"MARKET":"LIMIT",product_type:"MIS",timestamp:l.timestamp},follower_ids:Array.from(o)})}),t=await e.json();if(!e.ok)throw Error(t.message||"Failed to copy trade");let r=t.summary||{};i({title:"Trade Copied",description:"✅ ".concat(r.successful||0," successful, ⚠️ ").concat(r.skipped||0," skipped, ❌ ").concat(r.failed||0," failed")}),m(new Set),s(!1)}catch(e){console.error("Copy error:",e),i({title:"Error",description:e.message||"Failed to copy trade",variant:"destructive"})}finally{b(!1)}};return l?(0,r.jsx)(c.lG,{open:t,onOpenChange:s,children:(0,r.jsxs)(c.Cf,{className:"sm:max-w-[425px]",children:[(0,r.jsxs)(c.c7,{children:[(0,r.jsx)(c.L3,{children:"Copy Trade to Followers"}),(0,r.jsx)(c.rr,{children:"Select which followers should receive this trade copy"})]}),(0,r.jsxs)("div",{className:"space-y-4",children:[(0,r.jsx)("div",{className:"bg-muted p-3 rounded-md space-y-2",children:(0,r.jsxs)("div",{className:"grid grid-cols-2 gap-4 text-sm",children:[(0,r.jsxs)("div",{children:[(0,r.jsx)("span",{className:"text-muted-foreground",children:"Symbol:"}),(0,r.jsx)("p",{className:"font-medium",children:l.symbol})]}),(0,r.jsxs)("div",{children:[(0,r.jsx)("span",{className:"text-muted-foreground",children:"Side:"}),(0,r.jsx)("p",{className:"font-medium ".concat("Buy"===l.side?"text-green-600":"text-red-600"),children:l.side})]}),(0,r.jsxs)("div",{children:[(0,r.jsx)("span",{className:"text-muted-foreground",children:"Quantity:"}),(0,r.jsx)("p",{className:"font-medium",children:l.quantity})]}),(0,r.jsxs)("div",{children:[(0,r.jsx)("span",{className:"text-muted-foreground",children:"Price:"}),(0,r.jsxs)("p",{className:"font-medium",children:["₹",l.price.toFixed(2)]})]})]})}),(0,r.jsxs)("div",{className:"space-y-3",children:[(0,r.jsxs)("div",{className:"flex items-center justify-between",children:[(0,r.jsx)(f.J,{className:"text-base font-semibold",children:"Select Followers"}),(0,r.jsx)(n.$,{type:"button",variant:"outline",size:"sm",onClick:()=>{o.size===d.length?m(new Set):m(new Set(d.map(e=>e.id)))},children:o.size===d.length?"Deselect All":"Select All"})]}),0===d.length?(0,r.jsxs)(g.Fc,{children:[(0,r.jsx)(j.A,{className:"h-4 w-4"}),(0,r.jsx)(g.TN,{children:"No follower accounts available. Add followers first."})]}):(0,r.jsx)("div",{className:"space-y-2 max-h-64 overflow-y-auto border rounded-md p-3",children:d.map(e=>(0,r.jsxs)("div",{className:"flex items-center space-x-2",children:[(0,r.jsx)(x,{id:e.id,checked:o.has(e.id),onCheckedChange:()=>(e=>{let t=new Set(o);t.has(e)?t.delete(e):t.add(e),m(t)})(e.id),disabled:u}),(0,r.jsx)(f.J,{htmlFor:e.id,className:"cursor-pointer flex-1 font-medium",children:e.name||e.id}),(0,r.jsxs)("span",{className:"text-xs text-muted-foreground",children:[e.lotMultiplier,"x"]})]},e.id))})]}),(0,r.jsxs)("div",{className:"text-sm text-muted-foreground",children:[o.size," of ",d.length," selected"]})]}),(0,r.jsxs)(c.Es,{children:[(0,r.jsx)(n.$,{type:"button",variant:"outline",onClick:()=>s(!1),disabled:u,children:"Cancel"}),(0,r.jsx)(n.$,{type:"button",onClick:N,disabled:u||0===o.size,children:u?(0,r.jsxs)(r.Fragment,{children:[(0,r.jsx)(y.A,{className:"h-4 w-4 mr-2 animate-spin"}),"Copying..."]}):"Copy to Selected"})]})]})}):null}function N(e){let{showAccount:t=!0}=e,[s,c]=(0,a.useState)(!0),[o,m]=(0,a.useState)([]),[u,x]=(0,a.useState)(null),[f,h]=(0,a.useState)(null),[p,j]=(0,a.useState)(!1),y=async()=>{var e,t;c(!0),x(null);try{let t=await fetch("/api/alice/trades");if(!t.ok)throw Error("Status ".concat(t.status));let s=(null!=(e=(await t.json().catch(()=>({}))).trades)?e:[]).map(e=>{var t,s,r,a,l,n;let d=e.symbol||e.instrument||e.scrip||"",i=Number(null!=(s=null!=(t=e.quantity)?t:e.qty)?s:0),c=Number(null!=(a=null!=(r=e.price)?r:e.fillPrice)?a:0),o=e.timestamp||new Date().toISOString(),m=e.side||e.buySell||"Buy";return{id:(e.id||"".concat(e.account||"A","-").concat(d,"-").concat(c,"-").concat(i,"-").concat(m,"-").concat(o)).replace(/\s+/g,""),timestamp:o,account:e.account||e.accountName||"Master",symbol:d,type:e.type||e.product||"Market",side:m,quantity:i,tradedQty:Number(null!=(n=null!=(l=e.tradedQty)?l:e.filledQty)?n:i),price:c,status:e.status||"Filled"}}),r=new Map;for(let e of s)r.set(e.id,e);let a=Array.from(r.values()).sort((e,t)=>new Date(t.timestamp).getTime()-new Date(e.timestamp).getTime());m(a)}catch(e){console.error("Failed to fetch trades",e),x(null!=(t=null==e?void 0:e.message)?t:"Failed to fetch")}finally{c(!1)}};return(0,a.useEffect)(()=>{y()},[]),(0,r.jsxs)("div",{className:"w-full overflow-auto",children:[(0,r.jsx)("div",{className:"flex items-center justify-between mb-2",children:(0,r.jsx)("div",{className:"flex gap-2",children:(0,r.jsx)(n.$,{variant:"ghost",size:"sm",onClick:y,children:"Refresh"})})}),s?(0,r.jsxs)("div",{className:"space-y-2",children:[(0,r.jsx)(d.E,{className:"h-8 w-full"}),(0,r.jsx)(d.E,{className:"h-8 w-full"}),(0,r.jsx)(d.E,{className:"h-8 w-full"})]}):u?(0,r.jsxs)("div",{className:"text-sm text-destructive",children:["Error loading trades: ",u]}):(0,r.jsxs)(l.XI,{children:[(0,r.jsx)(l.A0,{children:(0,r.jsxs)(l.Hj,{children:[(0,r.jsx)(l.nd,{children:"Time"}),(0,r.jsx)(l.nd,{children:"Side"}),(0,r.jsx)(l.nd,{children:"Instrument"}),(0,r.jsx)(l.nd,{children:"Product"}),(0,r.jsx)(l.nd,{className:"text-right",children:"Qty"}),(0,r.jsx)(l.nd,{className:"text-right",children:"Traded Qty"}),(0,r.jsx)(l.nd,{className:"text-right",children:"Price"}),(0,r.jsx)(l.nd,{className:"text-center",children:"Action"})]})}),(0,r.jsx)(l.BF,{children:0===o.length?(0,r.jsx)(l.Hj,{children:(0,r.jsx)(l.nA,{colSpan:8,className:"h-24 text-center",children:"No trades found."})}):o.map(e=>(0,r.jsxs)(l.Hj,{children:[(0,r.jsx)(l.nA,{children:function(e){let t=new Date(e);return isNaN(t.getTime())?"":t.toLocaleTimeString()}(e.timestamp)}),(0,r.jsx)(l.nA,{children:(0,r.jsx)("span",{className:"Buy"===e.side?"inline-block bg-green-100 text-green-800 px-3 py-1 rounded text-sm":"inline-block bg-red-100 text-red-800 px-3 py-1 rounded text-sm",children:e.side})}),(0,r.jsx)(l.nA,{className:"font-medium",children:e.symbol}),(0,r.jsx)(l.nA,{className:"text-sm text-muted-foreground",children:e.type}),(0,r.jsx)(l.nA,{className:"text-right",children:e.quantity}),(0,r.jsx)(l.nA,{className:"text-right",children:e.tradedQty}),(0,r.jsxs)(l.nA,{className:"text-right",children:["₹",e.price.toFixed(2)]}),(0,r.jsx)(l.nA,{className:"text-center",children:(0,r.jsx)(n.$,{size:"sm",variant:"outline",onClick:()=>{h(e),j(!0)},children:(0,r.jsx)(i.A,{className:"h-4 w-4"})})})]},e.id))})]}),(0,r.jsx)(b,{open:p,onOpenChange:j,trade:f})]})}},7270:(e,t,s)=>{s.d(t,{A0:()=>d,BF:()=>i,Hj:()=>c,XI:()=>n,nA:()=>m,nd:()=>o});var r=s(5155),a=s(2115),l=s(4269);let n=a.forwardRef((e,t)=>{let{className:s,...a}=e;return(0,r.jsx)("div",{className:"relative w-full overflow-auto",children:(0,r.jsx)("table",{ref:t,className:(0,l.cn)("w-full caption-bottom text-sm",s),...a})})});n.displayName="Table";let d=a.forwardRef((e,t)=>{let{className:s,...a}=e;return(0,r.jsx)("thead",{ref:t,className:(0,l.cn)("[&_tr]:border-b",s),...a})});d.displayName="TableHeader";let i=a.forwardRef((e,t)=>{let{className:s,...a}=e;return(0,r.jsx)("tbody",{ref:t,className:(0,l.cn)("[&_tr:last-child]:border-0",s),...a})});i.displayName="TableBody",a.forwardRef((e,t)=>{let{className:s,...a}=e;return(0,r.jsx)("tfoot",{ref:t,className:(0,l.cn)("border-t bg-muted/50 font-medium [&>tr]:last:border-b-0",s),...a})}).displayName="TableFooter";let c=a.forwardRef((e,t)=>{let{className:s,...a}=e;return(0,r.jsx)("tr",{ref:t,className:(0,l.cn)("border-b transition-colors hover:bg-muted/50 data-[state=selected]:bg-muted",s),...a})});c.displayName="TableRow";let o=a.forwardRef((e,t)=>{let{className:s,classNameName:a,...n}=e;return(0,r.jsx)("th",{ref:t,className:(0,l.cn)("h-12 px-4 text-left align-middle font-medium text-muted-foreground [&:has([role=checkbox])]:pr-0",s),...n})});o.displayName="TableHead";let m=a.forwardRef((e,t)=>{let{className:s,classNameName:a,...n}=e;return(0,r.jsx)("td",{ref:t,className:(0,l.cn)("p-4 align-middle [&:has([role=checkbox])]:pr-0",s),...n})});m.displayName="TableCell",a.forwardRef((e,t)=>{let{className:s,...a}=e;return(0,r.jsx)("caption",{ref:t,className:(0,l.cn)("mt-4 text-sm text-muted-foreground",s),...a})}).displayName="TableCaption"},8332:(e,t,s)=>{s.d(t,{Fc:()=>i,TN:()=>c});var r=s(5155),a=s(2115),l=s(3101),n=s(4269);let d=(0,l.F)("relative w-full rounded-lg border p-4 [&>svg~*]:pl-7 [&>svg+div]:translate-y-[-3px] [&>svg]:absolute [&>svg]:left-4 [&>svg]:top-4 [&>svg]:text-foreground",{variants:{variant:{default:"bg-background text-foreground",destructive:"border-destructive/50 text-destructive dark:border-destructive [&>svg]:text-destructive"}},defaultVariants:{variant:"default"}}),i=a.forwardRef((e,t)=>{let{className:s,variant:a,...l}=e;return(0,r.jsx)("div",{ref:t,role:"alert",className:(0,n.cn)(d({variant:a}),s),...l})});i.displayName="Alert",a.forwardRef((e,t)=>{let{className:s,...a}=e;return(0,r.jsx)("h5",{ref:t,className:(0,n.cn)("mb-1 font-medium leading-none tracking-tight",s),...a})}).displayName="AlertTitle";let c=a.forwardRef((e,t)=>{let{className:s,...a}=e;return(0,r.jsx)("div",{ref:t,className:(0,n.cn)("text-sm [&_p]:leading-relaxed",s),...a})});c.displayName="AlertDescription"}}]);